{% extends 'base.html' %}

{% block title %}Dashboard - Infranaut{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-sidebar">
        <div class="user-profile">
            <div class="profile-image" id="profileContainer">
                <img id="profileImg" src="{{ session.profile_image }}" alt="Profile">
                <input type="file" id="profileUpload" accept="image/*" aria-label="Upload profile picture">
                <div class="profile-upload-overlay">
                    <i class="fas fa-camera"></i>
                    <span>Change Photo</span>
                </div>
                <div class="profile-upload-progress" style="display: none;">
                    <div class="spinner">
                        <i class="fas fa-circle-notch fa-spin"></i>
                    </div>
                    <span>Uploading...</span>
                </div>
            </div>
            <div class="user-info">
                <h3>{{ session.username }}</h3>
                <p>{{ session.email }}</p>
            </div>
        </div>
        <nav class="dashboard-nav">
            <ul>
                <li class="active"><a href="#apis"><i class="fas fa-plug"></i> API Management</a></li>
                <li><a href="#settings"><i class="fas fa-cog"></i> Settings</a></li>
                <li><a href="#billing"><i class="fas fa-credit-card"></i> Billing</a></li>
                <li><a href="{{ url_for('logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </nav>
    </div>
    
    <main class="dashboard-content">
        <div class="dashboard-header">
            <h1>API Management</h1>
        </div>
        
        <div class="api-coming-soon">
            <div class="coming-soon-card">
                <div class="icon-wrapper">
                    <i class="fas fa-tools"></i>
                </div>
                <h2>Coming Soon</h2>
                <p class="main-text">This section is currently under development.</p>
                <p class="sub-text">We're building tools to help you manage, monitor, and secure your APIs more effectively.</p>
                <div class="status-badge">
                    <span>ðŸš§ Under Design & Development</span>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const profileUpload = document.getElementById('profileUpload');
        const profileImg = document.getElementById('profileImg');
        const profileContainer = document.getElementById('profileContainer');
        const uploadProgress = document.querySelector('.profile-upload-progress');
        
        // Profile image upload handling
        profileUpload.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                // Show upload progress
                uploadProgress.style.display = 'flex';
                profileContainer.classList.add('uploading');
                
                const formData = new FormData();
                formData.append('profile_image', file);
                
                fetch('/upload_profile_image', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Update image with animation
                        const newImg = new Image();
                        newImg.onload = function() {
                            profileImg.src = data.image_url;
                            profileContainer.classList.add('updated');
                            setTimeout(() => {
                                profileContainer.classList.remove('updated');
                            }, 1500);
                        };
                        newImg.src = data.image_url;
                    } else {
                        // Show error in a toast-like notification
                        const errorToast = document.createElement('div');
                        errorToast.className = 'toast error';
                        errorToast.textContent = 'Failed to upload image: ' + data.error;
                        document.body.appendChild(errorToast);
                        setTimeout(() => errorToast.remove(), 3000);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Show error toast
                    const errorToast = document.createElement('div');
                    errorToast.className = 'toast error';
                    errorToast.textContent = 'Failed to upload image';
                    document.body.appendChild(errorToast);
                    setTimeout(() => errorToast.remove(), 3000);
                })
                .finally(() => {
                    // Hide upload progress
                    uploadProgress.style.display = 'none';
                    profileContainer.classList.remove('uploading');
                });
            }
        });
    });
</script>
{% endblock %}